<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>試験結果ダウンロード</title>
    <style>
      body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; background-color: #f0f2f5; }
      .container { padding: 40px; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center; max-width: 400px; width: 90%; }
      h1 { margin-top: 0; }
      input { width: 250px; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; }
      button { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
      #messageArea { margin-top: 20px; min-height: 2em; }
      #messageArea a { display: inline-block; padding: 10px 20px; background-color: #28a745; color: white; text-decoration: none; border-radius: 4px; font-weight: bold; }
      .error-message { color: red; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>試験結果ダウンロード</h1>
      <p>IDを入力してください</p>
      <input type="text" id="userId" placeholder="IDを入力">
      <br>
      <button onclick="findPdf()">検索</button>
      <div id="messageArea"></div>
    </div>
    <script>
      async function findPdf() {
        const id = document.getElementById('userId').value;
        const messageArea = document.getElementById('messageArea');
        const button = document.querySelector('button');
        
        messageArea.innerHTML = '検索中...';
        button.disabled = true;

        if (!id) {
          messageArea.innerHTML = '<span class="error-message">IDを入力してください。</span>';
          button.disabled = false;
          return;
        }

        try {
          const response = await fetch(`/.netlify/functions/find-pdf?id=${encodeURIComponent(id)}`);

          if (response.ok) {
            const data = await response.json();
            const link = document.createElement('a');
            link.href = data.url;
            link.textContent = 'ここをクリックしてダウンロード';
            link.target = '_blank';
            messageArea.innerHTML = '';
            messageArea.appendChild(link);
          } else if (response.status === 404) {
            messageArea.innerHTML = '<span class="error-message">IDが見つかりませんでした。</span>';
          } else {
            messageArea.innerHTML = '<span class="error-message">サーバーでエラーが発生しました。</span>';
          }
        } catch (error) {
          console.error('Fetch Error:', error);
          messageArea.innerHTML = '<span class="error-message">通信エラーが発生しました。</span>';
        } finally {
          button.disabled = false;
        }
      }
    </script>
  </body>
</html>